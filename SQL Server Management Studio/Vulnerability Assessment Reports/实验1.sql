--***************************************
--              实验一
--***************************************

--创建表S
CREATE TABLE S
(
SNO INT NOT NULL,
SNAME CHAR(10) NOT NULL,
[STATUS] INT NOT NULL,
CITY CHAR(10) NOT NULL
);
--创建表P
CREATE TABLE P
(
PNO INT  NOT NULL,
PNAME CHAR(20)NOT NULL,
COLOR CHAR(4) NOT NULL,
[WEIGHT] INT NOT NULL
);
--创建表J
CREATE TABLE J
(
JNO INT NOT NULL,
JNAME CHAR(10)NOT NULL,
CITY CHAR(10) NOT NULL
);
--创建表SPJ
CREATE TABLE SPJ
(
SNO  INT NOT NULL,
PNO INT NOT NULL,
JNO INT NOT NULL,
QTY INT NOT NULL
);

--删除表
--USE SPJ
--GO
--drop table S;
--drop table P;
--drop table J;
--drop table SPJ;
--GO

--(3)在前三个表上建立对编码的索引，索引名分别为S_Idx、P_Idx和J_Idx；
CREATE UNIQUE INDEX S_Idx ON S(SNO);
CREATE UNIQUE INDEX P_Idx ON P(PNO);
CREATE UNIQUE INDEX J_Idx ON J(JNO);

----删除索引
--DROP INDEX S_Idx;
--DROP INDEX P_Idx;
--DROP INDEX J_Idx;
--DROP INDEX SPJ_idx;

--(4)在SPJ表的字段SNo、PNo、JNo上建立名为SPJ_idx的索引；
CREATE UNIQUE INDEX SPJ_idx ON SPJ(SNO,PNO,JNO);

--(5)在SPJ表的字段SNo、PNo、JNo上建立外键约束（参照完整性）
alter table SPJ add constraint fk_SNO foreign key(SNO) references S(SNO);
alter table SPJ add constraint fk_PNO foreign key(PNO) references P(PNO);
alter table SPJ add constraint fk_JNO foreign key(JNO) references J(JNO);

----删除外键约束
----alter table 表名 drop constraint 外键名;
--alter table SPJ drop constraint fk_SNO;
--alter table SPJ drop constraint fk_PNO;
--alter table SPJ drop constraint fk_JNO;


--(6)在SSMS中将课本上四个表的数据输入到表中
--S表插入数据
INSERT INTO S
(SNO,SNAME,[STATUS] ,CITY )
VALUES
(1,'精益',20,'天津'),
(2,'盛锡',10,'北京'),
(3,'东方红',30,'北京'),
(4,'丰泰盛',20,'天津'),
(5,'为民',30,'上海');

--P表插入数据
INSERT INTO P(PNO,PNAME,COLOR,[WEIGHT])
VALUES 
(1,'螺母','红',12),
(2,'螺栓','绿',17),
(3,'螺丝刀','蓝',14),
(4,'螺丝刀','红',14),
(5,'凸轮','蓝',40),
(6,'齿轮','红',30);

--J表插入数据
INSERT INTO J(JNO ,JNAME ,CITY )
VALUES 
(1,'三建','北京'),
(2,'一汽','长春'),
(3,'弹簧厂','天津'),
(4,'造船厂','天津'),
(5,'机车厂','唐山'),
(6,'无线电厂','常州'),
(7,'半导体厂','南京');

--SPJ表插入数据
INSERT INTO SPJ(SNO ,PNO ,JNO,QTY)
VALUES
(1,1,1,200),
('1','1','3',100),
('1','1','4',700),
('1','2','2',100),
('2','3','1',400),
('2','3','2',200),
('2','3','4',500),
('2','3','5',400),
('2','5','1',400),
('2','5','2',100),
('3','1','1',200),
('3','3','1',200),
('4','5','1',100),
('4','6','3',300),
('4','6','4',200),
('5','2','4',100),
('5','3','1',200),
('5','6','2',200),
('5','6','4',500);

--(8)自行设计一种需求，完成对四个表中其中一个表的查询操作；
--查询红色零件的零件代码
SELECT PNO AS RED_PNO
FROM P
WHERE COLOR='红';